<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Audio Visualizer</title>
<style>
    body {
        margin: 0;
        background: #0e0e0e;
        font-family: Arial, sans-serif;
        color: white;
        overflow-x: hidden;
    }

    .container {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
    }

    .thumb {
        width: 120px;
        height: 120px;
        border-radius: 15px;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .thumb:hover {
        transform: scale(1.05);
    }

    .title {
        font-size: 24px;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    /* Waveform */
    .waveform {
        position: relative;
        width: 100%;
        height: 60px;
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 4px;
        transform: scaleY(-1); /* ðŸ”¥ Invert waveform vertically */
    }

    .bar {
        width: 6px;
        height: 40px;
        background: #4da6ff;
        border-radius: 3px;
        transform-origin: top;
        transition: height 0.1s ease;
    }
</style>
</head>
<body>

<div class="container">
    <img id="thumb" class="thumb" src="thumb1.jpg" onclick="togglePlay()">
    <div class="title" id="songTitle">Song 1</div>
</div>

<!-- Centered waveform -->
<div class="waveform" id="waveform"></div>

<audio id="audio" src="song1.mp3"></audio>

<script>
/* --------------------
   SONG SELECTION SYSTEM
-----------------------*/
let songs = [
    { title: "å‡„ç¾Žåœ°- éƒ­é¡¶", file: "ssVid.net--The-Fog-Space.mp3", img: "unnamed (22).jpg" },
    { title: "Song 2", file: "song2.mp3", img: "thumb2.jpg" },
    { title: "Song 3", file: "song3.mp3", img: "thumb3.jpg" }
];

let index = 0;
let audio = document.getElementById("audio");
let thumb = document.getElementById("thumb");
let titleBox = document.getElementById("songTitle");

function loadSong(i) {
    index = i;
    audio.src = songs[i].file;
    thumb.src = songs[i].img;
    titleBox.textContent = songs[i].title;
}

loadSong(0); // no autoplay

/* --------------------
   PLAY / PAUSE (thumbnail button)
-----------------------*/
function togglePlay() {
    if (audio.paused) {
        audio.play();
    } else {
        audio.pause();
    }
}

/* --------------------
   WAVEFORM SETUP
-----------------------*/
const BAR_COUNT = 32;   // all bars move now
const MAX_HEIGHT = 40;  // bar height limit

const waveform = document.getElementById("waveform");
let bars = [];

for (let i = 0; i < BAR_COUNT; i++) {
    let bar = document.createElement("div");
    bar.classList.add("bar");
    waveform.appendChild(bar);
    bars.push(bar);
}

/* Audio Analyser */
let ctx = new AudioContext();
let src = ctx.createMediaElementSource(audio);
let analyser = ctx.createAnalyser();
analyser.fftSize = 128; // smaller = smoother bars

src.connect(analyser);
analyser.connect(ctx.destination);

let buffer = new Uint8Array(analyser.frequencyBinCount);

/* --------------------
   ANIMATION LOOP
-----------------------*/
function animate() {
    requestAnimationFrame(animate);

    analyser.getByteFrequencyData(buffer);

    for (let i = 0; i < BAR_COUNT; i++) {
        let v = buffer[i] / 255;
        let h = v * MAX_HEIGHT;

        // dead-bar fix: if super quiet, apply tiny noise
        if (h < 2) h = Math.random() * 2;

        bars[i].style.height = h + "px";
    }
}

animate();

/* unlock audio on first interaction (mobile fix) */
document.body.onclick = () => {
    if (ctx.state === "suspended") ctx.resume();
};
</script>

</body>
</html>
